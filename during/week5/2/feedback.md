---
layout: default
---

## Recreate GitHub Profile Feedback

#### Testing methods which return arrays

Take a look at these tests, and enjoy the associated comments:

    def test_display_repository_name
      #is this cheating???? or still a good test
      repo = GithubApi.new("masonfmatthews")
      assert_equal "rails_assignments", repo.get_repository[0]
    end


    def test_desplay_repo_last_update
      #is this cheating???? or still a good test
      update = GithubApi.new("masonfmatthews")
      assert_equal "2015-05-11T16:10:43Z", update.last_update[0]
    end

First off, this is not cheating.  The tests are good.  In terms of object design, though, it would be nicer if there was a `Repository` model as well.  We'd set it up so that the `GithubApi` instances each had an array of repositories inside them.  We could then loop over repositories, rather than looping over arrays of strings by their indices.

The only thing we really HAVE to change about this is the name of the `get_repository` and `last_update` methods.  Theyâ€™re returning many things rather than one thing, so the names of the methods should be plural.

#### Using half of Ruby's view power

Here's a Rails form, but one that doesn't trust Rails to do its job:

    <%= form_tag("repositories/show", method: "post") do %>
      <label for="name">username:</label>
      <%= text_field_tag :name, nil, placeholder: "username" %>
      <%= submit_tag "SEARCH" %>
    <% end %>

This does work, but it has taken a lot more developer effort than it needs to.  Since we have path helpers (and since forms are by default POSTs), the first line can get simpler.  Also, the label can be generated by a helper like the text_field tag was.  Observe:

    <%= form_tag(repositories_show_path) do %>
      <%= label_tag :name, "Username" %>
      <%= text_field_tag :name, nil, placeholder: "Username" %>
      <%= submit_tag "SEARCH" %>
    <% end %>

Voila!


#### Giving up on testing?

Here's a test(?):

    def test_repository_list
      puts @github.repositories_list
    end

Although the method name starts with `_test`, it's not really a test.  No asserts or refutes are present.  I'm guessing this was a "whoops, I ran out of time" scenario, which is understandable.  If you are in that situation, though, delete things like this and commit in a clean state!

#### Fat controllers, oh no!

Here is a fat action in a controller, and as we know fat here is something best avoided:

    def show
      user = UserApi.new(params[:username])
      @username = user.username
      @real_name = user.real_name
      @user_id = user.user_id
      @company = user.company
      @location = user.location
      @email = user.email
      @join_date = user.join_date
      @followers = user.number_of_followers
      @following = user.number_following
      @starred = user.number_starred
      @repo_name = user.repo_name
      @repo_description = user.repo_description
      @repo_language = user.repo_language
      @stargazers_count = user.repo_stargazers_count
      @forks_count = user.repo_forks_count
    end

Okay, gotta admit, this makes the view a little thinner.  We can say `<%= @email %>`, which is about as succinct as it gets.  However, it's best to make the WHOLE object be your instance variable like this:

    def show
      @user = UserApi.new(params[:username])
    end

The controller is WAY nicer, and in your view, you just have to say `<%= @user.email %>`.  A little more, sure, but this is a perfectly acceptable thing to have in your view.

#### ERB form nuances

Take a look at this form in a Rails view:

    <%= form_tag github_profiles_show_path do %>
    <%= "Enter a GitHub username: " %>
    <%= text_field_tag :name %>
    <%= submit_tag :"View GitHub profile"  %>
    <% end %>

The first thing to note: no tabs!

    <%= form_tag github_profiles_show_path do %>
      <%= "Enter a GitHub username: " %>
      <%= text_field_tag :name %>
      <%= submit_tag :"View GitHub profile"  %>
    <% end %>

Okay.  Now that we're all breathing again, look at the second line.  It's a pure string in ERB, which is not necessary.  We can do this instead:

    <%= form_tag github_profiles_show_path do %>
      Enter a GitHub username:
      <%= text_field_tag :name %>
      <%= submit_tag :"View GitHub profile"  %>
    <% end %>

Nice.  Last thing.  Look at the fourth line.  I think there's an accidental `:` there.  It just so happens to work because it's making a symbol out of a string, and `submit_tag` is okay taking a symbol as its first parameter.  Here is the better way:

    <%= form_tag github_profiles_show_path do %>
      Enter a GitHub username:
      <%= text_field_tag :name %>
      <%= submit_tag "View GitHub profile"  %>
    <% end %>
